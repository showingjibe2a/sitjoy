<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>材料管理</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .material-type-bar {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            flex-wrap: wrap;
            padding: 0.45rem 0.6rem;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.18);
            backdrop-filter: blur(2px);
        }
        .material-type-add {
            width: 34px;
            height: 34px;
            border-radius: 8px;
            border: 1px solid rgba(155, 74, 74, 0.2);
            background: #9b4a4a;
            color: #fff;
            font-size: 18px;
            line-height: 1;
            cursor: pointer;
            box-shadow: 0 6px 14px rgba(0, 0, 0, 0.08);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .material-type-add:hover {
            filter: brightness(0.95);
        }
        .material-type-radio input {
            display: none;
        }
        .material-type-radio span {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 0.55rem 0.95rem;
            border-radius: 8px;
            background: var(--morandi-mist);
            color: var(--morandi-ink);
            border: 1px solid var(--morandi-sand);
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.15s ease;
            user-select: none;
        }
        .material-type-radio {
            background: transparent;
            padding: 0;
            margin: 0;
        }
        .material-type-radio span:hover {
            color: var(--morandi-ink);
            background: rgba(207, 199, 189, 0.55);
        }
        .material-type-radio input:checked + span {
            background: #9b4a4a;
            color: #fff;
            border-color: #9b4a4a;
        }
        .material-parent-select {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
            width: 100%;
        }
        .material-parent-select select {
            padding: 0.65rem 0.8rem;
            border-radius: 6px;
            border: 2px solid var(--morandi-sand);
            background: #fff;
            color: var(--morandi-ink);
            font-size: 0.95rem;
            min-width: 240px;
        }
        .material-parent-hint {
            font-size: 0.85rem;
            color: var(--morandi-slate);
        }
        .material-row-parent td {
            font-weight: 600;
            background: rgba(236, 231, 223, 0.65);
        }
        .material-row-child td {
            background: rgba(236, 231, 223, 0.35);
        }
        .material-name-cell {
            position: relative;
        }
        .material-child-tooltip {
            position: absolute;
            left: 100%;
            top: 50%;
            transform: translate(12px, -50%);
            background: #fff;
            border-radius: 10px;
            border: 1px solid var(--morandi-sand);
            box-shadow: 0 10px 24px rgba(15, 23, 42, 0.12);
            padding: 0.6rem 0.8rem;
            min-width: 180px;
            max-width: 240px;
            display: none;
            z-index: 6;
        }
        .material-row-parent:hover .material-child-tooltip {
            display: block;
        }
        .material-child-tooltip-title {
            font-size: 0.8rem;
            color: var(--morandi-slate);
            margin-bottom: 0.35rem;
        }
        .material-child-item {
            font-size: 0.92rem;
            color: var(--morandi-ink);
            padding: 0.2rem 0;
        }
        .material-row-child .material-name-indent {
            padding-left: 1.2rem;
            position: relative;
        }
        .material-toggle {
            border: none;
            background: transparent;
            color: var(--morandi-ink);
            cursor: pointer;
            font-size: 1.15rem;
            width: 1.2rem;
            text-align: center;
        }
        .material-parent-line {
            font-size: 0.85rem;
            color: var(--morandi-slate);
            margin-top: 0.25rem;
        }
        .material-toggle-line {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            margin-bottom: 0.15rem;
        }
        .material-expand-cell {
            width: 26px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="site-header"></div>

    <div class="container">
        <section class="hero" style="margin-bottom: 1.5rem;">
            <h2>材料管理</h2>
            <p>维护材料中英文名称与材料类型</p>
        </section>

        <section class="pm-layout">
            <div class="card pm-card">
                <div class="pm-toolbar">
                    <div class="pm-toolbar-actions">
                        <div class="form-group pm-search" style="margin: 0;">
                            <span class="pm-search-title">搜索</span>
                            <input type="text" id="searchInput" placeholder="搜索材料名称/英文名/类型">
                            <button class="btn-primary" onclick="loadMaterialList()">搜索</button>
                            <button class="btn-secondary" onclick="resetSearch()">清空</button>
                        </div>
                        <span class="pm-divider" aria-hidden="true"></span>
                        <button class="btn-accent" onclick="openCreateModal()">新增</button>
                    </div>
                </div>
                <div class="pm-toolbar" style="margin-top: 0.85rem;">
                    <div class="pm-toolbar-actions">
                        <span class="pm-search-title">材料类型管理</span>
                    </div>
                </div>
                <div class="material-type-bar" id="materialTypeBar" style="margin-top: 0.6rem;">
                    <button class="material-type-add" type="button" aria-label="新增类型" onclick="openTypeCreateModal()">+</button>
                </div>
            </div>

            <div>
                <table class="pm-table" id="materialTable">
                    <thead>
                        <tr>
                            <th style="width:36px;"></th>
                            <th>材料名称</th>
                            <th>材料英文名</th>
                            <th>材料类型</th>
                            <th style="width:180px;">创建时间</th>
                            <th style="width:160px;">操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="6" style="text-align:center;">加载中...</td></tr>
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <div class="pm-modal" id="pm-modal">
        <div class="pm-modal-content">
            <h3 id="pm-modal-title" style="margin-top:0;">新增材料</h3>
            <div class="pm-form">
                <div class="form-group">
                    <label for="modalMaterialName">材料名称<span class="required-asterisk">*</span></label>
                    <input type="text" id="modalMaterialName" class="required-field" placeholder="例如：实木">
                </div>
                <div class="form-group">
                    <label for="modalMaterialNameEn">材料英文名<span class="required-asterisk">*</span></label>
                    <input type="text" id="modalMaterialNameEn" class="required-field" placeholder="例如：Solid Wood">
                </div>
                <div class="form-group pm-form-full">
                    <label for="modalMaterialType">材料类型<span class="required-asterisk">*</span></label>
                    <div class="material-type-group" id="modalMaterialType"></div>
                </div>
                <div class="form-group pm-form-full">
                    <label for="modalMaterialParent">父体（可选）</label>
                    <div class="material-parent-select">
                        <select id="modalMaterialParent"></select>
                        <span class="material-parent-hint">不选择默认为父体</span>
                    </div>
                </div>
            </div>
            <div id="modalStatus" class="response" style="display:none; margin-top:0.75rem;"></div>
            <div class="pm-modal-actions">
                <button class="btn-secondary" onclick="closeModal()">取消</button>
                <button class="btn-primary" id="modalSaveBtn" onclick="saveMaterialFromModal()">保存</button>
            </div>
        </div>
    </div>

    <div class="pm-modal" id="pm-type-modal">
        <div class="pm-modal-content">
            <h3 id="pm-type-modal-title" style="margin-top:0;">新增材料类型</h3>
            <div class="pm-form">
                <div class="form-group">
                    <label for="modalTypeName">类型名称<span class="required-asterisk">*</span></label>
                    <input type="text" id="modalTypeName" class="required-field" placeholder="例如：面料">
                </div>
            </div>
            <div id="typeModalStatus" class="response" style="display:none; margin-top:0.75rem;"></div>
            <div class="pm-modal-actions">
                <button class="btn-secondary" onclick="closeTypeModal()">取消</button>
                <button class="btn-primary" id="typeModalSaveBtn" onclick="saveMaterialTypeFromModal()">保存</button>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2026 SITJOY | 内部使用</p>
    </footer>

    <script>
        let editId = null;
        let editTypeId = null;
        let materialTypeOptions = [];
        let pendingMaterialTypeId = null;
        let activeTypeId = null;
        let materialItemsCache = [];
        const expandedParents = new Set();
        const parentOptionsCache = new Map();

        function showModalStatus(message, isError) {
            const el = document.getElementById('modalStatus');
            el.style.display = 'block';
            el.style.background = isError ? '#ffecec' : '#f0fff0';
            el.style.color = isError ? '#a33' : '#2f6f2f';
            el.innerText = message;
        }

        function resetModalStatus() {
            const el = document.getElementById('modalStatus');
            el.style.display = 'none';
            el.innerText = '';
        }

        function resetSearch() {
            document.getElementById('searchInput').value = '';
            loadMaterialList();
        }

        function openCreateModal() {
            editId = null;
            document.getElementById('pm-modal-title').innerText = '新增材料';
            document.getElementById('modalMaterialName').value = '';
            document.getElementById('modalMaterialNameEn').value = '';
            setMaterialTypeSelect('');
            renderParentSelect('', '', null);
            document.getElementById('modalSaveBtn').innerText = '保存';
            resetModalStatus();
            document.getElementById('pm-modal').classList.add('active');
            document.getElementById('modalMaterialName').focus();
        }

        function openEditModal(item) {
            editId = item.id;
            document.getElementById('pm-modal-title').innerText = '编辑材料';
            document.getElementById('modalMaterialName').value = item.name || '';
            document.getElementById('modalMaterialNameEn').value = item.name_en || '';
            setMaterialTypeSelect(item.material_type_id || '');
            renderParentSelect(item.material_type_id || '', item.parent_id || '', item.id);
            document.getElementById('modalSaveBtn').innerText = '保存';
            resetModalStatus();
            document.getElementById('pm-modal').classList.add('active');
            document.getElementById('modalMaterialName').focus();
        }

        function closeModal() {
            document.getElementById('pm-modal').classList.remove('active');
            editId = null;
        }

        function saveMaterialFromModal() {
            const name = document.getElementById('modalMaterialName').value.trim();
            const nameEn = document.getElementById('modalMaterialNameEn').value.trim();
            const selectedType = document.querySelector('input[name="modalMaterialType"]:checked');
            const materialTypeId = selectedType ? selectedType.value : '';
            const parentIdRaw = document.getElementById('modalMaterialParent').value;
            const parentId = parentIdRaw ? Number(parentIdRaw) : null;
            if (!name || !nameEn || !materialTypeId) {
                showModalStatus('请填写材料中英文名称并选择类型', true);
                return;
            }

            const payload = {
                name: name,
                name_en: nameEn,
                material_type_id: materialTypeId,
                parent_id: parentId
            };
            let method = 'POST';
            if (editId) {
                payload.id = editId;
                method = 'PUT';
            }

            fetch('/api/material', {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(r => r.json())
            .then(data => {
                if (data.status === 'success') {
                    showModalStatus(editId ? '更新成功' : '新增成功', false);
                    setTimeout(() => {
                        closeModal();
                        loadMaterialList();
                    }, 400);
                } else {
                    showModalStatus(data.message || '操作失败', true);
                }
            })
            .catch(err => showModalStatus('请求失败: ' + err, true));
        }

        function deleteMaterial(id) {
            if (!confirm('确认删除该材料？')) return;
            fetch('/api/material', {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id: id })
            })
            .then(r => r.json())
            .then(data => {
                if (data.status === 'success') {
                    loadMaterialList();
                } else {
                    alert(data.message || '删除失败');
                }
            })
            .catch(err => alert('请求失败: ' + err));
        }

        function getMaterialTypeLabel(item) {
            return item.material_type_name || '';
        }

        function renderMaterialTypeRadios(selectedValue) {
            const container = document.getElementById('modalMaterialType');
            container.innerHTML = '';
            if (!materialTypeOptions.length) {
                const empty = document.createElement('div');
                empty.style.color = '#6b7280';
                empty.textContent = '暂无类型，请先创建';
                container.appendChild(empty);
                return;
            }
            materialTypeOptions.forEach(item => {
                const label = document.createElement('label');
                label.className = 'material-type-option material-type-radio';
                label.innerHTML = `
                    <input type="radio" name="modalMaterialType" value="${item.id}">
                    <span>${item.name}</span>
                `;
                const input = label.querySelector('input');
                if (selectedValue && String(selectedValue) === String(item.id)) {
                    input.checked = true;
                }
                input.addEventListener('change', () => {
                    renderParentSelect(item.id, '', editId);
                });
                container.appendChild(label);
            });
        }

        function setMaterialTypeSelect(value) {
            if (!materialTypeOptions.length) {
                pendingMaterialTypeId = value || '';
                loadMaterialTypes();
            }
            renderMaterialTypeRadios(value || '');
        }

        function renderParentSelect(typeId, selectedParentId, excludeId) {
            const select = document.getElementById('modalMaterialParent');
            select.innerHTML = '';
            const placeholder = document.createElement('option');
            placeholder.value = '';
            placeholder.textContent = '设为父体（不归属）';
            select.appendChild(placeholder);

            if (!typeId) {
                return;
            }
            const cached = parentOptionsCache.get(String(typeId));
            if (cached) {
                applyParentOptions(cached, selectedParentId, excludeId);
            } else {
                loadParentOptions(typeId, selectedParentId, excludeId);
            }
        }

        function applyParentOptions(items, selectedParentId, excludeId) {
            const select = document.getElementById('modalMaterialParent');
            items.forEach(item => {
                if (String(item.id) === String(excludeId)) {
                    return;
                }
                if (item.parent_id) {
                    return;
                }
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.name} / ${item.name_en || ''}`.trim();
                if (selectedParentId && String(selectedParentId) === String(item.id)) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }


        function loadParentOptions(typeId, selectedParentId, excludeId) {
            fetch(`/api/material?type_id=${encodeURIComponent(typeId)}`)
                .then(r => r.json())
                .then(data => {
                    if (data.status !== 'success') {
                        return;
                    }
                    const items = data.items || [];
                    parentOptionsCache.set(String(typeId), items);
                    applyParentOptions(items, selectedParentId, excludeId);
                })
                .catch(() => {});
        }

        function loadMaterialTypes() {
            fetch('/api/material-type')
                .then(r => r.json())
                .then(data => {
                    if (data.status !== 'success') {
                        materialTypeOptions = [];
                        renderMaterialTypeRadios('');
                        renderMaterialTypeBar();
                        return;
                    }
                    materialTypeOptions = data.items || [];
                    const currentValue = pendingMaterialTypeId || (document.querySelector('input[name="modalMaterialType"]:checked') || {}).value || '';
                    pendingMaterialTypeId = null;
                    renderMaterialTypeRadios(currentValue);
                    renderMaterialTypeBar();
                })
                .catch(() => {
                    materialTypeOptions = [];
                    renderMaterialTypeRadios('');
                    renderMaterialTypeBar();
                });
        }

        function renderMaterialTypeBar() {
            const bar = document.getElementById('materialTypeBar');
            bar.innerHTML = '';
            const addBtn = document.createElement('button');
            addBtn.type = 'button';
            addBtn.className = 'material-type-add';
            addBtn.setAttribute('aria-label', '新增类型');
            addBtn.textContent = '+';
            addBtn.addEventListener('click', openTypeCreateModal);
            bar.appendChild(addBtn);

            const allLabel = document.createElement('label');
            allLabel.className = 'material-type-option material-type-radio';
            allLabel.innerHTML = `
                <input type="radio" name="materialTypeFilter" value="">
                <span>全部</span>
            `;
            const allInput = allLabel.querySelector('input');
            if (!activeTypeId) {
                allInput.checked = true;
            }
            allInput.addEventListener('click', () => {
                activeTypeId = null;
                loadMaterialList();
            });
            bar.appendChild(allLabel);

            materialTypeOptions.forEach(item => {
                const label = document.createElement('label');
                label.className = 'material-type-option material-type-radio';
                label.innerHTML = `
                    <input type="radio" name="materialTypeFilter" value="${item.id}">
                    <span>${item.name}</span>
                `;
                const input = label.querySelector('input');
                if (String(activeTypeId) === String(item.id)) {
                    input.checked = true;
                }
                input.addEventListener('click', () => {
                    activeTypeId = item.id;
                    loadMaterialList();
                });
                label.addEventListener('dblclick', () => openTypeEditModal(item));
                bar.appendChild(label);
            });
        }

        function showTypeModalStatus(message, isError) {
            const el = document.getElementById('typeModalStatus');
            el.style.display = 'block';
            el.style.background = isError ? '#ffecec' : '#f0fff0';
            el.style.color = isError ? '#a33' : '#2f6f2f';
            el.innerText = message;
        }

        function resetTypeModalStatus() {
            const el = document.getElementById('typeModalStatus');
            el.style.display = 'none';
            el.innerText = '';
        }

        function openTypeCreateModal() {
            editTypeId = null;
            document.getElementById('pm-type-modal-title').innerText = '新增材料类型';
            document.getElementById('modalTypeName').value = '';
            document.getElementById('typeModalSaveBtn').innerText = '保存';
            resetTypeModalStatus();
            document.getElementById('pm-type-modal').classList.add('active');
            document.getElementById('modalTypeName').focus();
        }

        function openTypeEditModal(item) {
            editTypeId = item.id;
            document.getElementById('pm-type-modal-title').innerText = '编辑材料类型';
            document.getElementById('modalTypeName').value = item.name || '';
            document.getElementById('typeModalSaveBtn').innerText = '保存';
            resetTypeModalStatus();
            document.getElementById('pm-type-modal').classList.add('active');
            document.getElementById('modalTypeName').focus();
        }

        function closeTypeModal() {
            document.getElementById('pm-type-modal').classList.remove('active');
            editTypeId = null;
        }

        function saveMaterialTypeFromModal() {
            const name = document.getElementById('modalTypeName').value.trim();
            if (!name) {
                showTypeModalStatus('请填写类型名称', true);
                return;
            }

            const payload = { name: name };
            let method = 'POST';
            if (editTypeId) {
                payload.id = editTypeId;
                method = 'PUT';
            }

            fetch('/api/material-type', {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(r => r.json())
            .then(data => {
                if (data.status === 'success') {
                    showTypeModalStatus(editTypeId ? '更新成功' : '新增成功', false);
                    setTimeout(() => {
                        closeTypeModal();
                        loadMaterialTypes();
                    }, 400);
                } else {
                    showTypeModalStatus(data.message || '操作失败', true);
                }
            })
            .catch(err => showTypeModalStatus('请求失败: ' + err, true));
        }

        function deleteMaterialType(id) {
            if (!confirm('确认删除该材料类型？')) return;
            fetch('/api/material-type', {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id: id })
            })
            .then(r => r.json())
            .then(data => {
                if (data.status === 'success') {
                    if (String(activeTypeId) === String(id)) {
                        activeTypeId = null;
                    }
                    loadMaterialTypes();
                    loadMaterialList();
                } else {
                    alert(data.message || '删除失败');
                }
            })
            .catch(err => alert('请求失败: ' + err));
        }

        function renderMaterialTable(items) {
            const rows = [];
            const parentMap = new Map();
            const childrenMap = new Map();
            items.forEach(item => {
                if (item.parent_id) {
                    if (!childrenMap.has(item.parent_id)) {
                        childrenMap.set(item.parent_id, []);
                    }
                    childrenMap.get(item.parent_id).push(item);
                } else {
                    parentMap.set(item.id, item);
                }
            });

            const renderRow = (item, isChild) => {
                const dateText = item.created_at ? new Date(item.created_at).toLocaleString('zh-CN') : '';
                const typeText = getMaterialTypeLabel(item);
                const hasChildren = childrenMap.has(item.id);
                const isExpanded = expandedParents.has(String(item.id));
                    const toggle = hasChildren
                        ? `<button class=\"material-toggle\" data-parent=\"${item.id}\">${isExpanded ? '▾' : '▸'}</button>`
                        : '';
                const childItems = childrenMap.get(item.id) || [];
                const childTooltip = !isChild && childItems.length
                    ? `
                        <div class="material-child-tooltip">
                            <div class="material-child-tooltip-title">子项</div>
                            ${childItems.map(child => `<div class=\"material-child-item\">${child.name}</div>`).join('')}
                        </div>
                    `
                    : '';
                const parentLine = item.parent_name
                    ? `<div class="material-parent-line">父体：${item.parent_name}</div>`
                    : '';
                const nameContent = isChild
                    ? `<div>${item.name}</div>${parentLine}`
                    : `<div>${item.name}</div>${parentLine}${childTooltip}`;
                const nameCell = isChild
                    ? `<td class=\"material-name-indent material-name-cell\">${nameContent}</td>`
                    : `<td class=\"material-name-cell\">${nameContent}</td>`;
                    const expandCell = isChild
                        ? `<td class=\"material-expand-cell\"></td>`
                        : `<td class=\"material-expand-cell\">${toggle}</td>`;
                return `
                    <tr class="${isChild ? 'material-row-child' : 'material-row-parent'}" data-parent="${item.parent_id || ''}" data-id="${item.id}">
                            ${expandCell}
                        ${nameCell}
                        <td>${item.name_en || ''}</td>
                        <td>${typeText}</td>
                        <td>${dateText}</td>
                        <td>
                            <div class="pm-actions">
                                <button class="btn-secondary" onclick='openEditModal(${JSON.stringify(item)})'>编辑</button>
                                <button class="btn-danger" onclick='deleteMaterial(${item.id})'>删除</button>
                            </div>
                        </td>
                    </tr>
                `;
            };

            items.forEach(item => {
                if (!item.parent_id) {
                    rows.push(renderRow(item, false));
                    const children = childrenMap.get(item.id) || [];
                    if (expandedParents.has(String(item.id))) {
                        children.forEach(child => rows.push(renderRow(child, true)));
                    }
                }
            });

            items.forEach(item => {
                if (item.parent_id && !parentMap.has(item.parent_id)) {
                    rows.push(renderRow(item, false));
                }
            });

            const tbody = document.querySelector('#materialTable tbody');
            tbody.innerHTML = rows.join('');
            tbody.querySelectorAll('.material-toggle').forEach(btn => {
                btn.addEventListener('click', () => {
                    const pid = btn.getAttribute('data-parent');
                    if (!pid) return;
                    if (expandedParents.has(String(pid))) {
                        expandedParents.delete(String(pid));
                    } else {
                        expandedParents.add(String(pid));
                    }
                    renderMaterialTable(materialItemsCache);
                });
            });
        }

        function loadMaterialList() {
            const q = document.getElementById('searchInput').value.trim();
            let url = q ? `/api/material?q=${encodeURIComponent(q)}` : '/api/material';
            if (activeTypeId) {
                const joiner = url.includes('?') ? '&' : '?';
                url = `${url}${joiner}type_id=${encodeURIComponent(activeTypeId)}`;
            }
            fetch(url)
                .then(r => r.json())
                .then(data => {
                    const tbody = document.querySelector('#materialTable tbody');
                    if (data.status !== 'success') {
                        tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; color:#a33;">${data.message || '加载失败'}</td></tr>`;
                        return;
                    }
                    const items = data.items || [];
                    materialItemsCache = items;
                    parentOptionsCache.clear();
                    if (items.length === 0) {
                        tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;">暂无数据</td></tr>';
                        return;
                    }
                    renderMaterialTable(items);
                })
                .catch(err => {
                    const tbody = document.querySelector('#materialTable tbody');
                    tbody.innerHTML = `<tr><td colspan="6" style="text-align:center; color:#a33;">加载失败: ${err}</td></tr>`;
                });
        }


        window.addEventListener('load', loadMaterialTypes);
        window.addEventListener('load', loadMaterialList);
        document.getElementById('pm-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        document.getElementById('pm-type-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeTypeModal();
            }
        });
        document.getElementById('searchInput').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                loadMaterialList();
            }
        });
    </script>
</body>
    <script src="/static/js/header.js"></script>
</html>
